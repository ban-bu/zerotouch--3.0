import{r as x,a as re,R as ae}from"./vendor-b1791c80.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=a(s);fetch(s.href,c)}})();var Y={exports:{}},$={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ne=x,le=Symbol.for("react.element"),oe=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,ce=ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,de={key:!0,ref:!0,__self:!0,__source:!0};function Q(r,t,a){var o,s={},c=null,n=null;a!==void 0&&(c=""+a),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(n=t.ref);for(o in t)ie.call(t,o)&&!de.hasOwnProperty(o)&&(s[o]=t[o]);if(r&&r.defaultProps)for(o in t=r.defaultProps,t)s[o]===void 0&&(s[o]=t[o]);return{$$typeof:le,type:r,key:c,ref:n,props:s,_owner:ce.current}}$.Fragment=oe;$.jsx=Q;$.jsxs=Q;Y.exports=$;var e=Y.exports,q={},G=re;q.createRoot=G.createRoot,q.hydrateRoot=G.hydrateRoot;const me={currentScenario:"retail",messages:{problem:[],llm:[],solution:[]},processing:{llm:!1,problem:!1,solution:!1},settings:{autoScroll:!0,showTimestamps:!0,enableNotifications:!0},statistics:{totalMessages:0,totalProcessingTime:0,averageResponseTime:0}},_={SET_SCENARIO:"SET_SCENARIO",ADD_MESSAGE:"ADD_MESSAGE",CLEAR_MESSAGES:"CLEAR_MESSAGES",SET_PROCESSING:"SET_PROCESSING",UPDATE_SETTINGS:"UPDATE_SETTINGS",UPDATE_STATISTICS:"UPDATE_STATISTICS"},pe=(r,t)=>{switch(t.type){case _.SET_SCENARIO:return{...r,currentScenario:t.payload};case _.ADD_MESSAGE:const{panel:a,message:o}=t.payload;return{...r,messages:{...r.messages,[a]:[...r.messages[a],o]},statistics:{...r.statistics,totalMessages:r.statistics.totalMessages+1}};case _.CLEAR_MESSAGES:return{...r,messages:{problem:[],llm:[],solution:[]},statistics:{...r.statistics,totalMessages:0}};case _.SET_PROCESSING:const{panel:s,isProcessing:c}=t.payload;return{...r,processing:{...r.processing,[s]:c}};case _.UPDATE_SETTINGS:return{...r,settings:{...r.settings,...t.payload}};case _.UPDATE_STATISTICS:return{...r,statistics:{...r.statistics,...t.payload}};default:return r}},ue=x.createContext(),xe=({children:r})=>{const[t,a]=x.useReducer(pe,me),o=x.useCallback(i=>{a({type:_.SET_SCENARIO,payload:i})},[]),s=x.useCallback((i,p)=>{a({type:_.ADD_MESSAGE,payload:{panel:i,message:p}})},[]),c=x.useCallback(()=>{a({type:_.CLEAR_MESSAGES})},[]),n=x.useCallback((i,p)=>{a({type:_.SET_PROCESSING,payload:{panel:i,isProcessing:p}})},[]),u=x.useCallback(i=>{a({type:_.UPDATE_SETTINGS,payload:i})},[]),m=x.useCallback(i=>{a({type:_.UPDATE_STATISTICS,payload:i})},[]),j={isAnyProcessing:Object.values(t.processing).some(Boolean),totalMessagesCount:Object.values(t.messages).reduce((i,p)=>i+p.length,0),hasMessages:Object.values(t.messages).some(i=>i.length>0)},d={...t,...j,setScenario:o,addMessage:s,clearMessages:c,setProcessing:n,updateSettings:u,updateStatistics:m};return e.jsx(ue.Provider,{value:d,children:r})};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var he={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),v=(r,t)=>{const a=x.forwardRef(({color:o="currentColor",size:s=24,strokeWidth:c=2,absoluteStrokeWidth:n,className:u="",children:m,...j},d)=>x.createElement("svg",{ref:d,...he,width:s,height:s,stroke:o,strokeWidth:n?Number(c)*24/Number(s):c,className:["lucide",`lucide-${ge(r)}`,u].join(" "),...j},[...t.map(([i,p])=>x.createElement(i,p)),...Array.isArray(m)?m:[m]]));return a.displayName=`${r}`,a};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=v("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=v("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=v("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=v("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=v("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=v("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=v("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=v("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=v("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=v("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=v("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=v("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=v("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=v("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=v("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=v("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=v("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=v("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=v("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=v("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=v("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=v("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=v("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ce=({scenarios:r,currentScenario:t,onScenarioChange:a})=>(r[t],e.jsx("div",{className:"flex items-center space-x-2",children:Object.values(r).map(o=>{const s=o.id===t;return e.jsxs("button",{onClick:()=>a(o.id),className:"flex items-center space-x-2 px-3 py-2 rounded-lg border transition-all duration-200 "+(s?"bg-blue-600 text-white border-blue-600 shadow-md":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"),title:o.description,children:[e.jsx("div",{className:"icon-container "+(s?"bg-gradient-to-br from-blue-500 to-purple-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"),children:e.jsx(o.icon,{className:"w-4 h-4"})}),e.jsx("div",{className:"text-sm font-medium",children:o.name})]},o.id)})})),Re=({message:r="正在发送消息..."})=>e.jsxs("div",{className:"flex items-center space-x-2 text-gray-500 text-sm",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{children:r})]}),Le=({message:r="AI正在思考"})=>e.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[e.jsx("span",{className:"text-sm",children:r}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-1 h-1 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-1 h-1 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"200ms"}}),e.jsx("div",{className:"w-1 h-1 bg-gray-400 rounded-full animate-pulse",style:{animationDelay:"400ms"}})]})]}),M=({children:r,type:t="fade",duration:a=300,show:o=!0,onExited:s=()=>{}})=>{const[c,n]=x.useState(o),[u,m]=x.useState(!1),j=(i,p,f)=>{const h="transition-all duration-300 ease-in-out";if(!p)return"opacity-0 scale-95";switch(i){case"fade":return`${h} opacity-100`;case"slide-up":return`${h} opacity-100 translate-y-0`;case"slide-down":return`${h} opacity-100 translate-y-0`;case"slide-left":return`${h} opacity-100 translate-x-0`;case"slide-right":return`${h} opacity-100 translate-x-0`;case"scale":return`${h} opacity-100 scale-100`;default:return`${h} opacity-100`}};if(x.useEffect(()=>{let i;return o&&!c?(n(!0),m(!0),i=setTimeout(()=>{m(!1)},50)):!o&&c&&(m(!0),i=setTimeout(()=>{n(!1),m(!1),s()},a)),()=>{clearTimeout(i)}},[o,c,a,s]),!c&&!o)return null;const d=j(t,o);return e.jsx("div",{className:d,children:r})},Ae=({scenario:r,messages:t,onSendMessage:a,isProcessing:o})=>{const[s,c]=x.useState(""),[n,u]=x.useState(null),m=x.useRef(null),j=x.useRef(null),d=()=>{var g;(g=m.current)==null||g.scrollIntoView({behavior:"smooth"})};x.useEffect(()=>{d()},[t]);const i=g=>{g.preventDefault(),!(!s.trim()&&!n)&&(a({text:s.trim(),image:n,timestamp:new Date().toISOString()}),c(""),u(null),j.current&&(j.current.value=""))},p=g=>{const N=g.target.files[0];N&&N.type.startsWith("image/")&&u(N)},f=()=>{u(null),j.current&&(j.current.value="")},h=()=>{c(r.example)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"panel-header",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(V,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"问题端"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r.problemRole})]})]}),e.jsx("button",{onClick:h,className:"btn-ghost text-xs",children:"插入示例"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4",children:[(!t||t.length===0)&&e.jsxs("div",{className:"text-center text-gray-500 py-8",children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"在这里输入您的需求或问题"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"支持文本和图片输入"})]}),t&&t.map((g,N)=>e.jsxs("div",{className:"space-y-2",children:[g.type==="user"&&e.jsx(M,{type:"slide-right",show:!0,children:e.jsxs("div",{className:"message-bubble message-user slide-in-right",children:[g.image&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:URL.createObjectURL(g.image),alt:"用户上传",className:"max-w-full h-auto rounded-lg shadow-md"})}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(V,{className:"w-4 h-4 text-white mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"message-content",children:e.jsx("p",{className:"whitespace-pre-wrap",children:g.text})}),e.jsx("div",{className:"text-xs text-blue-100 mt-1 opacity-75",children:new Date(g.timestamp).toLocaleTimeString()})]})]})]})}),g.type==="ai_response"&&e.jsx(M,{type:"slide-left",show:!0,children:e.jsx("div",{className:"message-bubble message-ai slide-in-left",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-gray-600 dark:text-gray-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"message-content",children:e.jsx("p",{className:"whitespace-pre-wrap",children:g.text})}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(g.timestamp).toLocaleTimeString()})]})]})})})]},N)),o&&e.jsx("div",{className:"message-bubble message-ai",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-gray-600"}),e.jsx(Le,{message:"AI正在分析您的问题"})]})}),e.jsx("div",{ref:m})]}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:e.jsx("form",{onSubmit:i,className:"space-y-3",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{value:s,onChange:g=>c(g.target.value),placeholder:`作为${r.problemRole}，请描述您的需求...`,className:"input-field resize-none transition-all duration-200 focus:shadow-md",rows:3,disabled:o}),n&&e.jsx(M,{type:"scale",show:!0,children:e.jsxs("div",{className:"mt-3 relative inline-block",children:[e.jsx("img",{src:URL.createObjectURL(n),alt:"预览",className:"max-w-xs h-auto rounded-lg border border-gray-300 shadow-md"}),e.jsx("button",{type:"button",onClick:f,className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs hover:bg-red-600 shadow-lg transition-all duration-200 hover:scale-110",children:"×"})]})}),o&&e.jsx("div",{className:"mt-2",children:e.jsx(Re,{message:"正在发送消息..."})})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("input",{ref:j,type:"file",accept:"image/*",onChange:p,className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:"btn-ghost p-3 transition-all duration-200 hover:scale-105 cursor-pointer",title:"上传图片",children:e.jsx(we,{className:"w-5 h-5"})}),e.jsx("button",{type:"submit",disabled:!s.trim()&&!n||o,className:"btn-primary p-3 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",title:"发送消息",children:e.jsx(ee,{className:"w-5 h-5"})})]})]})})})]})},Te=({processing:r,messages:t})=>{const a=x.useRef(null),o=()=>{var n;(n=a.current)==null||n.scrollIntoView({behavior:"smooth"})};x.useEffect(()=>{o()},[t]);const s=n=>n.includes("问题端")?e.jsx(F,{className:"w-4 h-4 text-blue-600"}):n.includes("方案端")?e.jsx(H,{className:"w-4 h-4 text-green-600"}):n.includes("建议")?e.jsx(L,{className:"w-4 h-4 text-purple-600"}):n.includes("追问")?e.jsx(je,{className:"w-4 h-4 text-orange-600"}):n.includes("最终")?e.jsx(be,{className:"w-4 h-4 text-indigo-600"}):e.jsx(A,{className:"w-4 h-4 text-gray-600"}),c=n=>n.includes("问题端")?"正在分析客户需求...":n.includes("方案端")?"正在优化企业回复...":n.includes("建议")?"正在生成专业建议...":n.includes("追问")?"正在生成追问问题...":n.includes("最终")?"正在处理最终回复...":"正在处理...";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"icon-container bg-gradient-to-br from-purple-500 to-indigo-600",children:e.jsx(A,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"AI 中介处理"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"智能分析和方案生成"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 mb-4",children:[t.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500 dark:text-gray-400 space-y-4",children:[e.jsx(M,{type:"fade",show:!0,children:e.jsx("div",{className:"p-4 bg-gradient-to-r from-purple-100 to-indigo-100 dark:from-purple-900/30 dark:to-indigo-900/30 rounded-full shadow-inner",children:e.jsx(Se,{className:"w-8 h-8 text-purple-600 dark:text-purple-400"})})}),e.jsx("p",{className:"text-lg",children:"LLM中介将在这里处理您的请求"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4 max-w-md",children:[e.jsx(M,{type:"slide-up",show:!0,delay:100,children:e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-200 flex flex-col items-center text-sm",children:[e.jsx(L,{className:"w-6 h-6 mb-2 text-amber-500"}),e.jsx("span",{children:"分析需求"})]})}),e.jsx(M,{type:"slide-up",show:!0,delay:200,children:e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-200 flex flex-col items-center text-sm",children:[e.jsx(H,{className:"w-6 h-6 mb-2 text-blue-500"}),e.jsx("span",{children:"生成方案"})]})}),e.jsx(M,{type:"slide-up",show:!0,delay:300,children:e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all duration-200 flex flex-col items-center text-sm",children:[e.jsx(F,{className:"w-6 h-6 mb-2 text-green-500"}),e.jsx("span",{children:"优化结果"})]})})]})]}),t.map((n,u)=>e.jsx(M,{type:"slide-left",show:!0,children:e.jsx("div",{className:"message-bubble message-system",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[s(n.title),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-secondary-800 mb-1",children:c(n.title)}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-secondary-600",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{children:"处理完成"})]}),n.output&&e.jsx("div",{className:"message-content mt-2 text-sm text-secondary-700 dark:text-secondary-300",children:e.jsx("pre",{className:"whitespace-pre-wrap",children:n.output})})]}),e.jsx("div",{className:"text-xs text-secondary-600 mt-2",children:new Date(n.timestamp).toLocaleTimeString()})]})]})})},u)),r&&e.jsx(M,{type:"fade",show:!0,children:e.jsx("div",{className:"p-4 rounded-lg border border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-900/20",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-sm text-purple-700 dark:text-purple-300",children:"AI正在处理中..."})]})})}),e.jsx("div",{ref:a})]})]})},De=({scenario:r,messages:t,onSendMessage:a,isProcessing:o,iterationProcessing:s,iterationMode:c,pendingResponse:n,onGenerateSuggestion:u,onGenerateFollowUp:m,onConfirmSend:j,onCancelIteration:d})=>{const[i,p]=x.useState(""),[f,h]=x.useState(""),g=x.useRef(null),N=()=>{var y;(y=g.current)==null||y.scrollIntoView({behavior:"smooth"})};x.useEffect(()=>{N()},[t]),x.useEffect(()=>{c&&n&&h(n)},[c,n]);const w=y=>{y.preventDefault(),i.trim()&&(a({text:i.trim(),timestamp:new Date().toISOString()}),p(""))},I=()=>{f.trim()&&(j(f.trim()),h(""))},b=()=>{p({retail:"为您推荐三款商务西装：1）海军蓝修身款A123，售价1280元，意大利进口面料，免费修改，适合演讲场合；2）深灰经典款B456，售价1150元，舒适透气，商务首选；3）炭黑现代款C789，售价1350元，时尚剪裁。175cm身高建议选L码，提供3天内修改服务，可预约试穿。",enterprise:"推荐开发AI驱动的个性化推荐系统：第一阶段（1个月）用户行为数据收集分析，第二阶段（1.5个月）算法开发测试，第三阶段（0.5个月）部署优化。预计投入3名算法工程师、2名前端开发，总预算45万元，预期提升留存率至48%。",education:"波粒二象性可以通过双缝实验理解：当光通过两个缝时表现为波（产生干涉条纹），当我们观测光子通过哪个缝时表现为粒子（条纹消失）。建议做法：1）观看双缝实验视频，2）学习光电效应原理，3）练习相关计算题，4）参加实验课亲自操作。"}[r.id]||"")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"icon-container bg-gradient-to-br from-green-500 to-emerald-600",children:e.jsx(Z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"解决方案"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:r.solutionRole})]})]}),e.jsx("button",{onClick:b,className:"text-xs text-green-600 hover:text-green-700 underline",children:"插入示例"})]})}),c&&e.jsx(M,{type:"slide-down",show:!0,children:e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-blue-800 dark:text-blue-200",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"迭代模式 - 请确认最终回复内容"})]}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-300 mt-1",children:'您可以继续编辑内容，确认无误后点击"确认发送"将回复发送给客户'})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4 p-4",children:[(!t||t.length===0)&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-gray-500 dark:text-gray-400 space-y-4",children:[e.jsx(M,{type:"fade",show:!0,children:e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30 rounded-full shadow-inner",children:e.jsx(Z,{className:"w-8 h-8 text-green-600 dark:text-green-400"})})}),e.jsx("p",{className:"text-lg",children:"等待接收LLM翻译的需求"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"在此基础上提供定制化解决方案"})]}),t&&t.map((y,S)=>e.jsx(M,{type:y.type==="user"?"slide-right":"slide-left",show:!0,children:e.jsxs("div",{className:"space-y-2",children:[y.type==="llm_request"&&e.jsx("div",{className:"message-bubble bg-blue-50 text-blue-900 border border-blue-200 shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-blue-700 mb-1",children:"来自LLM的翻译需求"}),e.jsx("div",{className:"message-content",children:e.jsx("p",{className:"whitespace-pre-wrap text-gray-800 dark:text-gray-200",children:y.text})}),e.jsx("div",{className:"text-xs text-blue-600 mt-1 opacity-75",children:new Date(y.timestamp).toLocaleTimeString()})]})]})}),y.type==="user"&&e.jsxs("div",{className:"message-bubble bg-green-100 text-green-900 ml-auto shadow-sm hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"message-content",children:e.jsx("p",{className:"whitespace-pre-wrap text-gray-800 dark:text-gray-200",children:y.text})}),e.jsx("div",{className:"text-xs text-green-700 mt-1 opacity-75",children:new Date(y.timestamp).toLocaleTimeString()})]}),y.type==="ai_response"&&e.jsx("div",{className:"message-bubble message-ai shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-gray-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:"LLM优化后的响应"}),e.jsx("div",{className:"message-content",children:e.jsx("p",{className:"whitespace-pre-wrap text-gray-800 dark:text-gray-200",children:y.text})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(y.timestamp).toLocaleTimeString()})]})]})}),y.type==="suggestion"&&e.jsx("div",{className:"message-bubble bg-purple-50 text-purple-900 border border-purple-200 shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(L,{className:"w-4 h-4 text-purple-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-purple-700 mb-1",children:"AI生成的建议"}),e.jsx("div",{className:"message-content",children:e.jsx("p",{className:"whitespace-pre-wrap text-gray-800 dark:text-gray-200",children:y.text})}),e.jsx("div",{className:"text-xs text-purple-600 mt-1 opacity-75",children:new Date(y.timestamp).toLocaleTimeString()})]})]})}),y.type==="followup"&&e.jsx("div",{className:"message-bubble bg-orange-50 text-orange-900 border border-orange-200 shadow-sm hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(K,{className:"w-4 h-4 text-orange-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-medium text-orange-700 mb-1",children:"AI生成的追问"}),e.jsx("div",{className:"message-content",children:e.jsx("p",{className:"whitespace-pre-wrap text-gray-800 dark:text-gray-200",children:y.text})}),e.jsx("div",{className:"text-xs text-orange-600 mt-1 opacity-75",children:new Date(y.timestamp).toLocaleTimeString()})]})]})})]})},S)),s&&e.jsx(M,{type:"fade",show:!0,children:e.jsx("div",{className:"message-bubble message-ai border border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-900/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"w-4 h-4 text-purple-700 dark:text-purple-400"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),e.jsx("span",{className:"text-sm text-purple-700 dark:text-purple-300",children:"AI正在生成..."})]})})}),o&&!s&&e.jsx(M,{type:"fade",show:!0,children:e.jsx("div",{className:"message-bubble message-ai border border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4 text-green-700 dark:text-green-400"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),e.jsx("div",{ref:g})]}),c&&e.jsx(M,{type:"slide-up",show:!0,children:e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-yellow-50 dark:bg-yellow-900/20",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-yellow-800 dark:text-yellow-200",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"编辑最终回复内容"})]}),e.jsx("textarea",{value:f,onChange:y=>h(y.target.value),placeholder:"编辑最终回复内容...",className:"input-field resize-none transition-all duration-200 focus:shadow-md",rows:4,disabled:o}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:I,disabled:!f.trim()||o,className:"flex-1 btn-primary p-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none transition-all duration-200 hover:scale-105 flex items-center justify-center space-x-2",title:"确认发送给客户",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"确认发送"})]}),e.jsxs("button",{onClick:d,disabled:o,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",title:"取消迭代",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{children:"取消"})]})]})]})})}),!c&&e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("form",{onSubmit:w,className:"space-y-3",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:i,onChange:y=>p(y.target.value),placeholder:`作为${r.solutionRole}，请提供您的专业建议...`,className:"input-field resize-none transition-all duration-200 focus:shadow-md",rows:3,disabled:o||s})}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsx("button",{type:"submit",disabled:!i.trim()||o||s,className:"btn-primary p-3 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none transition-all duration-200 hover:scale-105",title:"发送解决方案",children:e.jsx(ee,{className:"w-5 h-5"})})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:u,disabled:s||!t||t.length===0,className:"flex-1 px-3 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",title:"AI生成建议",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-purple-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"生成中..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{children:"生成相应建议"})]})}),e.jsx("button",{type:"button",onClick:m,disabled:s||!t||t.length===0,className:"flex-1 px-3 py-2 bg-orange-100 hover:bg-orange-200 text-orange-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",title:"AI生成追问",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-orange-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"生成中..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"生成相应追问"})]})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"💡 基于LLM中介的分析结果提供解决方案"})})]})})]})},Pe=()=>{const[r,t]=x.useState([]),a=x.useCallback(n=>{const u=Date.now()+Math.random(),m={id:u,type:"info",duration:5e3,...n};t(j=>[...j,m]),m.duration>0&&setTimeout(()=>{o(u)},m.duration)},[]),o=x.useCallback(n=>{t(u=>u.filter(m=>m.id!==n))},[]);x.useEffect(()=>{window.showNotification=a},[a]);const s=n=>{switch(n){case"success":return e.jsx(W,{className:"w-5 h-5 text-green-600"});case"error":return e.jsx(ye,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(fe,{className:"w-5 h-5 text-yellow-600"});default:return e.jsx(Ne,{className:"w-5 h-5 text-blue-600"})}},c=n=>{switch(n){case"success":return"bg-green-50 border-green-200 text-green-800";case"error":return"bg-red-50 border-red-200 text-red-800";case"warning":return"bg-yellow-50 border-yellow-200 text-yellow-800";default:return"bg-blue-50 border-blue-200 text-blue-800"}};return r.length===0?null:e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:r.map(n=>e.jsx("div",{className:`max-w-sm w-full border rounded-lg p-4 shadow-lg transition-all duration-300 transform translate-x-0 ${c(n.type)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[s(n.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[n.title&&e.jsx("h4",{className:"text-sm font-medium mb-1",children:n.title}),e.jsx("p",{className:"text-sm",children:n.message})]}),e.jsx("button",{onClick:()=>o(n.id),className:"flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(te,{className:"w-4 h-4"})})]})},n.id))})},se=(r,t="info",a={})=>{window.showNotification&&window.showNotification({message:r,type:t,...a})},Oe=(r,t={})=>{se(r,"success",t)},$e=(r,t={})=>{se(r,"info",t)},Ue=({isOpen:r,onClose:t,settings:a,onUpdateSettings:o})=>{const[s,c]=x.useState(a),n=x.useRef(null);x.useEffect(()=>{c(a)},[a]),x.useEffect(()=>{const d=i=>{n.current&&!n.current.contains(i.target)&&r&&t()};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[r,t]);const u=(d,i)=>{c(p=>({...p,[d]:i}))},m=()=>{o(s),Oe("设置已保存",{duration:2e3}),t()},j=()=>{const d={darkMode:window.matchMedia("(prefers-color-scheme: dark)").matches,fontSize:"medium",soundEnabled:!0,autoScroll:!0,showTimestamps:!0,language:"zh-CN",apiEndpoint:"https://api.example.com/v1",maxMessagesPerPanel:50};c(d)};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{ref:n,className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4 overflow-hidden transition-all duration-300 transform scale-100",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"设置"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors",children:e.jsx(te,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-6 py-4 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-3",children:"外观"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s.darkMode?e.jsx(ke,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"}):e.jsx(Ee,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"深色模式"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.darkMode,onChange:d=>u("darkMode",d.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"字体大小"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:s.fontSize})]}),e.jsxs("select",{value:s.fontSize,onChange:d=>u("fontSize",d.target.value),className:"block w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"small",children:"小"}),e.jsx("option",{value:"medium",children:"中"}),e.jsx("option",{value:"large",children:"大"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-3",children:"行为"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[s.soundEnabled?e.jsx(Me,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"}):e.jsx(_e,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"声音提示"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.soundEnabled,onChange:d=>u("soundEnabled",d.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"自动滚动到最新消息"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.autoScroll,onChange:d=>u("autoScroll",d.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"显示消息时间戳"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.showTimestamps,onChange:d=>u("showTimestamps",d.target.checked)}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary-600"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-3",children:"高级设置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300 mb-2",children:"语言"}),e.jsxs("select",{value:s.language,onChange:d=>u("language",d.target.value),className:"block w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"zh-CN",children:"简体中文"}),e.jsx("option",{value:"en-US",children:"English (US)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300 mb-2",children:"API端点"}),e.jsx("input",{type:"text",value:s.apiEndpoint,onChange:d=>u("apiEndpoint",d.target.value),className:"block w-full px-3 py-2 text-sm bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"https://api.example.com/v1"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300",children:"每个面板最大消息数"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.maxMessagesPerPanel})]}),e.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:s.maxMessagesPerPanel,onChange:d=>u("maxMessagesPerPanel",parseInt(d.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"})]})]})]})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 dark:bg-gray-750 border-t border-gray-200 dark:border-gray-700 flex justify-between",children:[e.jsx("button",{onClick:j,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-650",children:"重置"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-650",children:"取消"}),e.jsx("button",{onClick:m,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:bg-primary-700 dark:hover:bg-primary-600",children:"保存"})]})]})]})}):null},ze=({onClearMessages:r,onToggleSettings:t,onFocusInput:a})=>(x.useEffect(()=>{const o=s=>{const c=s.ctrlKey||s.metaKey;s.shiftKey,s.altKey;const n=["INPUT","TEXTAREA"].includes(s.target.tagName);if(c&&s.key==="k"&&!n){s.preventDefault(),r(),$e("已清空所有消息",{duration:2e3});return}if(c&&s.key===","&&!n){s.preventDefault(),t();return}if(c&&s.key==="/"&&!n){s.preventDefault(),X();return}if(c&&s.key==="1"&&!n){s.preventDefault(),a("problem");return}if(c&&s.key==="3"&&!n){s.preventDefault(),a("solution");return}if(s.key==="Escape"){document.querySelectorAll("[data-modal]").forEach(m=>{m.style.display!=="none"&&(m.style.display="none")});return}if(s.key==="F1"){s.preventDefault(),X();return}};return document.addEventListener("keydown",o),()=>{document.removeEventListener("keydown",o)}},[r,t,a]),null),X=()=>{const r=[{key:"Ctrl/Cmd + K",description:"清空所有消息"},{key:"Ctrl/Cmd + ,",description:"打开设置"},{key:"Ctrl/Cmd + /",description:"显示快捷键帮助"},{key:"Ctrl/Cmd + 1",description:"聚焦到问题端输入框"},{key:"Ctrl/Cmd + 3",description:"聚焦到方案端输入框"},{key:"Esc",description:"取消当前操作"},{key:"F1",description:"显示帮助"}];r.map(a=>`${a.key}: ${a.description}`).join(`
`);const t=document.createElement("div");t.setAttribute("data-modal","shortcuts-help"),t.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",t.innerHTML=`
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900">键盘快捷键</h3>
        <button class="text-gray-400 hover:text-gray-600" onclick="this.closest('[data-modal]').remove()">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="space-y-3">
        ${r.map(a=>`
          <div class="flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0">
            <span class="text-sm text-gray-600">${a.description}</span>
            <kbd class="px-2 py-1 text-xs font-mono bg-gray-100 rounded border">${a.key}</kbd>
          </div>
        `).join("")}
      </div>
      <div class="mt-6 text-center">
        <button 
          class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"
          onclick="this.closest('[data-modal]').remove()"
        >
          关闭
        </button>
      </div>
    </div>
  `,t.addEventListener("click",a=>{a.target===t&&t.remove()}),document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&t.remove()},1e4)},T={MODELSCOPE_API_URL:{}.VITE_MODELSCOPE_API_URL||"https://api-inference.modelscope.cn/v1",MODELSCOPE_API_KEY:{}.VITE_MODELSCOPE_API_KEY||"ms-150d583e-ed00-46d3-ab35-570f03555599",DEEPBRICKS_API_URL:{}.VITE_DEEPBRICKS_API_URL||"https://api.deepbricks.ai/v1/",DEEPBRICKS_MODEL:{}.VITE_DEEPBRICKS_MODEL||"GPT-5-Chat",DEEPBRICKS_API_KEY:{}.VITE_DEEPBRICKS_API_KEY||"sk-lNVAREVHjj386FDCd9McOL7k66DZCUkTp6IbV0u9970qqdlg",APP_TITLE:{}.VITE_APP_TITLE||"ZeroTouch AI中介服务",APP_VERSION:{}.VITE_APP_VERSION||"2.0.0",NODE_ENV:{}.NODE_ENV||"development",PORT:{}.PORT||3e3,ENABLE_DEBUG:{}.VITE_ENABLE_DEBUG==="true",ENABLE_SOUND:{}.VITE_ENABLE_SOUND!=="false",ENABLE_AUTO_SCROLL:{}.VITE_ENABLE_AUTO_SCROLL!=="false",MAX_MESSAGE_LENGTH:parseInt({}.VITE_MAX_MESSAGE_LENGTH)||2e3,REQUEST_TIMEOUT:parseInt({}.VITE_REQUEST_TIMEOUT)||3e4,IS_DEVELOPMENT:!1,IS_PRODUCTION:!0},O={baseURL:T.DEEPBRICKS_API_URL||"https://api.deepbricks.ai/v1/",model:T.DEEPBRICKS_MODEL||"GPT-5-Chat",apiKey:T.DEEPBRICKS_API_KEY||"sk-lNVAREVHjj386FDCd9McOL7k66DZCUkTp6IbV0u9970qqdlg"},D=(r,t=2e3)=>typeof r!="string"||r.length<=t?r:r.slice(0,t)+"…(truncated)",Ve=r=>{try{return r.map(t=>({role:t.role,content:D(t.content)}))}catch{return"[unserializable messages]"}},U=async(r,t=.7)=>{var a,o,s,c,n,u,m,j;try{const d=typeof import.meta<"u"&&{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}&&!1;if(console.groupCollapsed("[LLM] Request"),console.log("model:",O.model),console.log("temperature:",t),console.log("messages:",Ve(r)),console.time("[LLM] latency"),d){console.group("[LLM] Full Prompt");try{const h=r.map((g,N)=>`#${N+1} [${g.role}]
${g.content}`).join(`

---

`);console.log(h)}catch{}try{console.log("messages JSON:",JSON.stringify(r,null,2))}catch{}console.groupEnd()}const i=await fetch(`${O.baseURL}chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${O.apiKey}`},body:JSON.stringify({model:O.model,messages:r,temperature:t,max_tokens:2e3,stream:!1})});if(!i.ok)throw console.timeEnd("[LLM] latency"),console.log("status:",i.status,i.statusText),new Error(`API调用失败: ${i.status} ${i.statusText}`);const p=await i.json(),f=(s=(o=(a=p==null?void 0:p.choices)==null?void 0:a[0])==null?void 0:o.message)==null?void 0:s.content;if(console.timeEnd("[LLM] latency"),p!=null&&p.usage&&console.log("usage:",p.usage),console.log("responseMessage:",D(f)),d){console.group("[LLM] Raw Response");try{console.log("raw JSON:",JSON.stringify(p,null,2))}catch{}try{console.log("raw message:",JSON.stringify((n=(c=p==null?void 0:p.choices)==null?void 0:c[0])==null?void 0:n.message,null,2))}catch{}try{console.log("raw content:",(j=(m=(u=p==null?void 0:p.choices)==null?void 0:u[0])==null?void 0:m.message)==null?void 0:j.content)}catch{}console.groupEnd()}return console.groupEnd(),f}catch(d){try{console.groupEnd()}catch{}throw console.groupCollapsed("[LLM] Error"),console.error("魔搭API调用错误:",d),console.groupEnd(),d}},z=r=>{if(!r)return r;const t=["非常抱歉","抱歉","我未能理解","请您详细描述","请提供更多信息","信息不足","若有不符请指正","你好！很高兴能帮助你。","请问你现在是在寻找什么类型的商品","衣服、鞋子还是其他什么小物件","感谢您的反馈","我们非常重视","如果您有任何问题","如需.*帮助","请随时联系","客服团队","支持团队","为您提供满意的解决方案","我们会尽力.*解决","敬请谅解","忽略本次对话","继续浏览其他服务或信息","欢迎.*联系我们"];let a=r;return t.forEach(o=>{const s=new RegExp(o,"g");a=a.replace(s,"")}),a.trim()},B=(r,t)=>{for(const a of t){const o=r.indexOf(a);if(o!==-1)return{idx:o,keyword:a}}return{idx:-1,keyword:""}},Be=r=>{const t=typeof r=="string"?r:"",a={translation:"",solutionsText:"",confirmationsText:""},o=["【需求转译】","【需求翻译】","【转译结果】","【需求澄清】","需求转译","需求翻译","转译结果","需求澄清","客户需求转译","用户需求转译"],s=["【解决方案建议】","【建议方案】","【行动建议】","解决方案建议","建议的解决方案","方案建议","行动建议"],c=["【待确认信息】","【需确认信息】","【待确认】","待确认信息","需确认信息"],n=B(t,o),u=B(t,s),m=B(t,c),j=d=>{if(d===-1)return t.length;const i=[u.idx,m.idx,t.length].filter(p=>p!==-1&&p>d);return Math.min(...i)};if(n.idx!==-1){const d=n.idx+n.keyword.length,i=j(n.idx);a.translation=t.slice(d,i).trim()}else u.idx!==-1&&(a.translation=t.slice(0,u.idx).trim());if(u.idx!==-1){const d=u.idx+u.keyword.length,i=m.idx!==-1?m.idx:t.length;a.solutionsText=t.slice(d,i).trim()}if(m.idx!==-1){const d=m.idx+m.keyword.length;a.confirmationsText=t.slice(d).trim()}if(!a.translation){const d=u.idx!==-1?u.idx:t.search(/\n?\s*(方案|选项|建议)\s*[1-9]/);if(d!==-1&&d>0)a.translation=t.slice(0,d).trim();else{const i=t.slice(0,500),p=i.split(/\n{2,}/);a.translation=(p[0]||i).trim()}}return a},qe=async(r,t,a,o=[])=>{try{const s={retail:{systemRole:"你是一个专业的AI沟通助手，专门在顾客与企业门店之间提供精准的需求转译和解决方案建议。你的核心职责是：1)准确理解顾客的真实需求和潜在意图 2)将其转化为企业能够理解和执行的专业描述 3)基于企业能力提供具体可行的解决方案选项。",context:`场景边界：零售顾客-门店沟通。你需要同时理解双方可能存在的表达偏差：顾客可能表达不清晰或有隐含需求，企业可能用专业术语回复。

核心任务：
1. 深度理解：分析顾客的显性需求和隐性需求，识别可能的表达偏差
2. 精准转译：将顾客需求转化为包含产品类型、使用场景、预算范围、规格要求等关键信息的专业描述
3. 方案建议：基于转译结果，为企业提供2-3个具体可行的解决方案选项，包含产品推荐、服务建议、价格区间等
4. 不当输入处理：遇到情绪化、粗鲁或不当表达时，避免直接重复原话，转化为专业的服务导向分析`,example:`例如：顾客说"我需要一件适合商务场合的衣服" → 转译："顾客需要商务正装，用于重要会议，预算待确认，需要专业形象" → 方案建议："1)推荐经典商务西装套装，价格800-1500元，包含免费修改服务 2)推荐商务休闲装，价格500-800元，适合日常商务场合 3)提供个人形象顾问服务，根据具体需求定制搭配方案"

异常情况处理：遇到不当或情绪化表达 → 转译："顾客情绪较为激动，可能对服务体验存在不满，建议门店优先进行情绪安抚和问题了解" → 方案建议："1)安排专业服务人员进行一对一沟通 2)了解具体问题并提供针对性解决方案 3)提供额外的服务补偿或优惠措施"`},enterprise:{systemRole:"你是一个专业的AI沟通助手，专门在企业跨部门之间提供精准的需求转译和解决方案建议。你的核心职责是：1)准确理解业务部门的需求和技术部门的能力边界 2)消除部门间的沟通偏差 3)提供具体可行的技术解决方案选项。",context:`场景边界：企业内部跨部门沟通。你需要理解不同部门的语言差异：业务部门关注效果和时间，技术部门关注可行性和资源。

核心任务：
1. 需求解析：将业务需求转化为技术可理解的功能要求，包含具体指标、时间期限、资源约束
2. 方案设计：基于技术能力提供2-3个不同复杂度的解决方案选项
3. 风险评估：识别实施过程中可能的技术风险和资源需求`,example:'例如：市场部说"我们需要提升用户体验" → 转译："需要开发用户体验优化功能，目标提升用户留存率，时间3个月内" → 方案建议："1)快速方案：优化现有界面和交互，预计提升10%留存率，需要2周，成本5万 2)中等方案：重新设计核心流程，预计提升25%留存率，需要6周，成本15万 3)深度方案：全面重构用户体验，预计提升40%留存率，需要3个月，成本40万"'},education:{systemRole:"你是一个专业的AI教学助手，专门在学生与教师之间提供精准的学习需求转译和教学方案建议。你的核心职责是：1)深度理解学生的学习困难和知识盲点 2)将其转化为教师可操作的教学要点 3)提供多样化的教学解决方案选项。",context:`场景边界：师生互动的学习沟通。你需要理解学习过程中的认知偏差：学生可能无法准确表达困难点，教师可能用过于专业的语言回复。

核心任务：
1. 学习诊断：分析学生的具体困难点、知识背景、学习风格
2. 教学转译：将学习需求转化为包含知识点、难点分析、教学目标的专业描述
3. 方案建议：提供2-3种不同教学方法的具体实施方案`,example:'例如：学生说"我不懂这个概念" → 转译："学生对量子物理波粒二象性概念理解困难，需要从基础概念开始，通过实验例子建立认知" → 方案建议："1)实验演示法：通过双缝实验等经典实验，直观展示波粒二象性，适合视觉学习者 2)类比教学法：用水波和弹珠的类比，帮助理解抽象概念，适合逻辑思维强的学生 3)渐进式教学：从光的基本性质开始，逐步引入量子概念，适合基础较弱的学生"'}};if(!a||!s[a])throw new Error(`无效的场景类型: ${a}。支持的场景: ${Object.keys(s).join(", ")}`);const c=s[a];let n="";o&&o.length>0&&(n=`

聊天历史上下文：
`+o.slice(-6).map((f,h)=>{let g="AI处理";return f.type==="user"?f.panel==="problem"?g=a==="retail"?"顾客原话":a==="enterprise"?"市场部原话":"学生原话":f.panel==="solution"?g=a==="retail"?"门店人员原话":a==="enterprise"?"研发部原话":"教师原话":g=a==="retail"?"顾客原话":a==="enterprise"?"市场部原话":"学生原话":f.type==="llm_request"?g=a==="retail"?"门店实际看到":a==="enterprise"?"研发部实际看到":"教师实际看到":f.type==="ai_response"?g=a==="retail"?"顾客实际看到":a==="enterprise"?"市场部实际看到":"学生实际看到":f.type==="llm_processing"&&(g="AI翻译输出"),`${h+1}. ${g}: ${f.text}`}).join(`
`));const u=[{role:"system",content:`${c.systemRole}

${c.context}

${c.example}

增强指令：
1. 上下文理解：充分利用聊天历史，理解对话的完整背景和客户的真实需求
2. 深度优化：不仅转化语言，更要优化内容结构，确保客户获得最大价值
3. 行动导向：提供具体的下一步行动建议，帮助客户做出明智决策
4. 体验提升：确保回复友好、专业、有温度，提升整体沟通体验
5. 价值传递：清晰传达方案的价值和好处，帮助客户理解选择的意义
6. 风险预防：识别可能的误解或疑虑，主动提供澄清和保障
7. 风格限制：严格禁止输出任何客服话术或模板化表达（如"感谢您的反馈/我们非常重视/如需帮助请联系/联系我们的客服团队/为您提供满意的解决方案/敬请谅解/忽略本次对话/继续浏览"等），禁止道歉或致谢套话；只围绕当前场景内容进行事实性与可执行性表述，不输出联系渠道或平台政策信息。
8. 不当输入处理：遇到粗鲁、情绪化或不当表达时，严禁直接重复或引用原始内容，必须以专业方式分析潜在需求，转化为建设性的服务指导和解决方案建议。
9. 情绪转化原则：将负面情绪识别为服务改进机会，重点分析客户可能的实际需求和期望，提供积极的解决路径。`},{role:"user",content:`当前用户输入："${r}"${t?`
（用户还上传了一张图片）`:""}${n}

请按照以下结构输出：

【需求转译】
将用户需求转化为专业、具体的描述，包含所有关键信息

【解决方案建议】
基于转译结果，提供2-3个具体可行的解决方案选项：
方案1：[具体方案描述，包含实施建议、预期效果等]
方案2：[具体方案描述，包含实施建议、预期效果等]
方案3：[具体方案描述，包含实施建议、预期效果等]

【待确认信息】
如有需要进一步确认的关键信息，请列出（如无则写"无"）`}],m=await U(u,.1),j=z(m),d=Be(j),i=[{name:"需求分析与转译",content:d.translation}];d.solutionsText&&i.push({name:"解决方案建议",content:d.solutionsText}),d.confirmationsText&&d.confirmationsText!=="无"&&i.push({name:"待确认信息",content:d.confirmationsText});const p=d.translation;return console.groupCollapsed("[LLM] Parsed -> problem_input"),console.log("structuredOutput:",d),console.log("translatedMessage:",D(p)),console.groupEnd(),{steps:i,translatedMessage:p,structuredOutput:d}}catch(s){throw console.error("处理问题输入时出错:",s),s}},Ge=async(r,t,a=[])=>{try{const o={retail:{systemRole:"你是一位专业的零售业客户服务AI助手，专门负责将企业的专业回复转化为客户友好的表达。",context:"在零售场景中，企业通常会提供产品信息、价格方案、服务条款等专业内容。你的任务是将这些内容转化为客户容易理解和接受的语言，同时提供具体的行动建议，帮助客户做出购买决策。",example:`企业回复："该产品采用进口材料，符合国际标准，批发价格为单价80元，起订量100件。"
优化后："这款产品使用的是进口优质材料，品质有保障。如果您需要100件以上，我们可以给您80元/件的优惠价格。建议您可以先确认一下具体需要的数量，我们为您计算总价和配送方案。"`},enterprise:{systemRole:"你是一位专业的企业服务AI助手，专门负责将技术方案和商业提案转化为决策者易懂的表达。",context:"在企业服务场景中，技术团队通常会提供复杂的解决方案、技术规格、实施计划等。你需要将这些内容转化为业务决策者能够理解的语言，突出商业价值和实施路径。",example:`企业回复："我们建议采用微服务架构，使用Docker容器化部署，预计开发周期6个月，需要投入3名高级工程师。"
优化后："我们为您设计了一套灵活可扩展的系统架构，可以支持您业务的快速增长。整个项目大约需要6个月完成，我们会安排3位资深工程师专门负责。建议我们先安排一次详细的需求沟通，为您制定具体的实施计划和时间节点。"`},education:{systemRole:"你是一位专业的教育服务AI助手，专门负责将教学方案和课程安排转化为学生和家长易懂的表达。",context:"在教育场景中，教师和教务人员通常会提供课程安排、教学计划、学习要求等专业内容。你需要将这些转化为学生和家长容易理解的语言，突出学习价值和具体安排。",example:`企业回复："该课程采用STEAM教学法，包含理论讲解和实践操作，每周2课时，共计24课时，需要准备实验材料。"
优化后："这门课程会通过动手实践的方式让孩子学习，每周安排2节课，总共12周完成。孩子们会在课堂上进行有趣的实验和项目制作。建议您提前为孩子准备一些基础的实验材料，我们会提供详细的材料清单。"`}};if(!t||!o[t])throw new Error(`无效的场景类型: ${t}。支持的场景: ${Object.keys(o).join(", ")}`);const s=o[t];let c="";a&&a.length>0&&(c=`

聊天历史上下文：
`+a.slice(-6).map((w,I)=>{let b="AI处理";return w.type==="user"?w.panel==="problem"?b=t==="retail"?"顾客原话":t==="enterprise"?"市场部原话":"学生原话":w.panel==="solution"?b=t==="retail"?"门店人员原话":t==="enterprise"?"研发部原话":"教师原话":b=t==="retail"?"顾客原话":t==="enterprise"?"市场部原话":"学生原话":w.type==="llm_request"?b=t==="retail"?"门店实际看到":t==="enterprise"?"研发部实际看到":"教师实际看到":w.type==="ai_response"?b=t==="retail"?"顾客实际看到":t==="enterprise"?"市场部实际看到":"学生实际看到":w.type==="llm_processing"&&(b="AI翻译输出"),`${I+1}. ${b}: ${w.text}`}).join(`
`));const n=[{role:"system",content:`${s.systemRole}

${s.context}

${s.example}

增强指令：
1. 上下文理解：充分利用聊天历史，理解对话的完整背景和客户的真实需求
2. 深度优化：不仅转化语言，还要优化内容结构，确保客户获得最大价值
3. 行动导向：提供具体的下一步行动建议，帮助客户做出明智决策
4. 体验提升：确保回复友好、专业、有温度，提升整体沟通体验
5. 价值传递：清晰传达方案的价值和好处，帮助客户理解选择的意义
6. 风险预防：识别可能的误解或疑虑，主动提供澄清和保障
7. 风格限制：严格禁止输出任何客服话术或模板化表达（如“感谢您的反馈/我们非常重视/如需帮助请联系/联系我们的客服团队/为您提供满意的解决方案/敬请谅解/忽略本次对话/继续浏览”等），禁止道歉或致谢套话；只围绕当前场景内容进行事实性与可执行性表述，不输出联系渠道或平台政策信息。`},{role:"user",content:`企业方案端回复："${r}"${c}

请按照以下结构输出：

【优化回复】
将企业回复转化为客户友好、易懂的表达，包含关键信息和价值点

【行动建议】
基于当前情况，为客户提供2-3个具体的下一步行动选项：
选项1：[具体行动描述，包含预期结果]
选项2：[具体行动描述，包含预期结果]
选项3：[具体行动描述，包含预期结果]

【补充说明】
如有需要补充的重要信息或注意事项，请列出（如无则写"无"）`}],u=await U(n,.1),m=z(u),j=m.match(/【优化回复】\s*([\s\S]*?)(?=【行动建议】|$)/),d=m.match(/【行动建议】\s*([\s\S]*?)(?=【补充说明】|$)/),i=m.match(/【补充说明】\s*([\s\S]*?)$/),p=j?j[1].trim():m,f=d?d[1].trim():"",h=i?i[1].trim():"",g=[{name:"语言优化",content:p}];f&&f!=="无"&&g.push({name:"行动建议",content:f}),h&&h!=="无"&&g.push({name:"补充说明",content:h});let N=p;return f&&f!=="无"&&(N+=`

`+f),h&&h!=="无"&&(N+=`

`+h),console.groupCollapsed("[LLM] Parsed -> solution_response"),console.log("structuredOutput:",{optimizedReply:p,actionSuggestions:f,additionalInfo:h}),console.log("optimizedMessage:",D(N)),console.groupEnd(),{steps:g,optimizedMessage:N,structuredOutput:{optimizedReply:p,actionSuggestions:f,additionalInfo:h}}}catch(o){throw console.error("处理方案响应时出错:",o),o}},Fe=async(r,t,a=[])=>{try{const o={retail:{systemRole:"你是一位专业的零售顾问，专门为企业门店提供销售建议和解决方案。",context:"基于客户的需求和企业的情况，提供专业的销售建议，包括产品推荐、价格策略、服务方案等。",example:`客户需求："需要商务西装，预算800-1500元"
建议："建议推荐三款产品：1)经典款A123，售价1280元，意大利面料，免费修改；2)现代款B456，售价1150元，舒适透气；3)高端款C789，售价1350元，时尚剪裁。重点推荐A123，性价比最高，适合商务场合。"`},enterprise:{systemRole:"你是一位专业的企业技术顾问，专门为技术团队提供解决方案建议。",context:"基于业务需求和技术现状，提供技术方案建议，包括架构设计、技术选型、实施计划等。",example:`业务需求："提升用户体验，3个月内完成"
建议："建议采用渐进式优化方案：第一阶段(1个月)优化现有界面，第二阶段(1.5个月)重构核心流程，第三阶段(0.5个月)性能优化。预计投入3名开发人员，总成本30万元。"`},education:{systemRole:"你是一位专业的教育顾问，专门为教师提供教学方案建议。",context:"基于学生的学习需求和教学现状，提供教学建议，包括教学方法、课程安排、学习指导等。",example:`学生需求："理解量子物理波粒二象性"
建议："建议采用三步教学法：1)通过双缝实验视频建立直观认知；2)用光电效应实验理解粒子性；3)通过计算题巩固理解。预计需要4课时，建议准备实验材料。"`}};if(!t||!o[t])throw new Error(`无效的场景类型: ${t}`);const s=o[t];let c="";a&&a.length>0&&(c=`

对话历史：
`+a.slice(-4).map((w,I)=>{let b="AI处理";return w.type==="user"?w.panel==="problem"?b=t==="retail"?"顾客":t==="enterprise"?"市场部":"学生":w.panel==="solution"?b=t==="retail"?"门店人员":t==="enterprise"?"研发部":"教师":b=t==="retail"?"顾客":t==="enterprise"?"市场部":"学生":w.type==="ai_response"?b="AI优化回复":w.type==="llm_request"&&(b="需求转译"),`${I+1}. ${b}: ${w.text}`}).join(`
`));const n=[{role:"system",content:`${s.systemRole}

${s.context}

${s.example}

生成建议的指导原则：
1. 基于当前对话内容，提供具体可行的建议
2. 考虑企业能力和资源限制
3. 提供多个选项供企业选择
4. 包含具体的实施步骤和预期效果
5. 避免过于理论化的建议，注重实用性
6. 风格限制：禁止输出任何客服模板话术或联系/投诉引导语，只专注于专业建议与实施细节。`},{role:"user",content:`当前对话内容："${r}"${c}

请为企业提供专业的建议，包括：

【核心建议】
基于当前情况的主要建议

【具体方案】
提供2-3个具体的实施方案

【实施要点】
关键的实施步骤和注意事项`}],u=await U(n,.3),m=z(u),j=m.match(/【核心建议】\s*([\s\S]*?)(?=【具体方案】|$)/),d=m.match(/【具体方案】\s*([\s\S]*?)(?=【实施要点】|$)/),i=m.match(/【实施要点】\s*([\s\S]*?)$/),p=j?j[1].trim():m,f=d?d[1].trim():"",h=i?i[1].trim():"",g=[{name:"核心建议",content:p}];f&&g.push({name:"具体方案",content:f}),h&&g.push({name:"实施要点",content:h});let N=p;return f&&(N+=`

`+f),h&&(N+=`

`+h),console.groupCollapsed("[LLM] Parsed -> generate_suggestion"),console.log("structuredOutput:",{coreSuggestion:p,specificPlans:f,implementation:h}),console.log("suggestionMessage:",D(N)),console.groupEnd(),{steps:g,suggestionMessage:N,structuredOutput:{coreSuggestion:p,specificPlans:f,implementation:h}}}catch(o){throw console.error("生成企业建议时出错:",o),o}},Ke=async(r,t,a=[])=>{try{const o={retail:{systemRole:"你是一位专业的零售销售专家，专门帮助企业了解客户需求的关键信息。",context:"基于当前对话，识别需要进一步了解的关键信息，生成有针对性的追问。",example:`客户说："需要商务西装"
追问："请问您的具体使用场合是什么？预算范围大概是多少？您的身高体重是多少？对颜色和款式有什么偏好吗？"`},enterprise:{systemRole:"你是一位专业的企业需求分析师，专门帮助技术团队深入了解业务需求。",context:"基于当前对话，识别技术实现需要的关键信息，生成有针对性的追问。",example:`业务方说："需要提升用户体验"
追问："具体希望提升哪些方面的体验？目标用户群体是谁？当前的痛点是什么？有具体的时间要求吗？预算范围是多少？"`},education:{systemRole:"你是一位专业的教育需求分析师，专门帮助教师了解学生的学习情况。",context:"基于当前对话，识别教学需要的关键信息，生成有针对性的追问。",example:`学生说："不懂这个概念"
追问："您之前学过相关的基础知识吗？您更倾向于哪种学习方式？您希望达到什么样的理解程度？有什么具体的学习目标吗？"`}};if(!t||!o[t])throw new Error(`无效的场景类型: ${t}`);const s=o[t];let c="";a&&a.length>0&&(c=`

对话历史：
`+a.slice(-4).map((w,I)=>{let b="AI处理";return w.type==="user"?w.panel==="problem"?b=t==="retail"?"顾客":t==="enterprise"?"市场部":"学生":w.panel==="solution"?b=t==="retail"?"门店人员":t==="enterprise"?"研发部":"教师":b=t==="retail"?"顾客":t==="enterprise"?"市场部":"学生":w.type==="ai_response"?b="AI优化回复":w.type==="llm_request"&&(b="需求转译"),`${I+1}. ${b}: ${w.text}`}).join(`
`));const n=[{role:"system",content:`${s.systemRole}

${s.context}

${s.example}

生成追问的指导原则：
1. 基于当前对话内容，识别信息缺口
2. 生成3-5个有针对性的追问
3. 追问要具体、明确，避免模糊表达
4. 按照重要性排序
5. 使用友好的语气，避免过于直接
6. 风格限制：禁止输出"感谢您的反馈/我们非常重视/如需帮助请联系"等客服模板话术，只专注于针对性信息澄清。`},{role:"user",content:`当前对话内容："${r}"${c}

请生成有针对性的追问，帮助更好地了解需求：

【关键信息缺口】
识别当前对话中缺失的关键信息

【追问建议】
提供3-5个具体的追问问题

【追问策略】
建议的追问顺序和方式`}],u=await U(n,.3),m=z(u),j=m.match(/【关键信息缺口】\s*([\s\S]*?)(?=【追问建议】|$)/),d=m.match(/【追问建议】\s*([\s\S]*?)(?=【追问策略】|$)/),i=m.match(/【追问策略】\s*([\s\S]*?)$/),p=j?j[1].trim():"",f=d?d[1].trim():m,h=i?i[1].trim():"",g=[{name:"信息缺口分析",content:p||"基于当前对话分析需要进一步了解的信息"}];f&&g.push({name:"追问建议",content:f}),h&&g.push({name:"追问策略",content:h});let N=f;return h&&(N+=`

`+h),console.groupCollapsed("[LLM] Parsed -> generate_followup"),console.log("structuredOutput:",{infoGaps:p,followUpQuestions:f,strategy:h}),console.log("followUpMessage:",D(N)),console.groupEnd(),{steps:g,followUpMessage:N,structuredOutput:{infoGaps:p,followUpQuestions:f,strategy:h}}}catch(o){throw console.error("生成企业追问时出错:",o),o}},P=async({type:r,content:t,image:a,context:o,scenario:s,chatHistory:c=[]})=>{try{if(r==="problem_input")return await qe(t,a,s,c);if(r==="solution_response")return await Ge(t,s,c);if(r==="generate_suggestion")return await Fe(t,s,c);if(r==="generate_followup")return await Ke(t,s,c);throw new Error("未知的处理类型")}catch(n){throw console.error("LLM处理错误:",n),n}},Ze=r=>{const[t,a]=x.useState({problem:[],llm:[],solution:[]}),[o,s]=x.useState(!1),[c,n]=x.useState(!1),[u,m]=x.useState(!1),[j,d]=x.useState(null),i=x.useCallback((b,y)=>{a(S=>({...S,[b]:[...S[b],y]}))},[]),p=x.useCallback(()=>{a({problem:[],llm:[],solution:[]}),m(!1),d(null)},[]),f=x.useCallback(async b=>{const y={type:"user",text:b.text,image:b.image,timestamp:b.timestamp};i("problem",y),s(!0);try{const S=[...t.problem.filter(l=>l.type==="user"||l.type==="ai_response").map(l=>({...l,panel:"problem"})),...t.solution.filter(l=>l.type==="user"||l.type==="ai_response"||l.type==="llm_request").map(l=>({...l,panel:"solution"})),...t.llm.filter(l=>l.type==="processing"&&l.output).map(l=>({type:"llm_processing",text:l.output,timestamp:l.timestamp,panel:"llm"})),{...y,panel:"problem"}].sort((l,C)=>new Date(l.timestamp)-new Date(C.timestamp)),k=await P({type:"problem_input",content:b.text,image:b.image,context:"problem_to_solution",scenario:r,chatHistory:S}),R={type:"processing",title:"处理问题端输入",steps:k.steps,output:k.translatedMessage,timestamp:new Date().toISOString()};i("llm",R);const E={type:"llm_request",text:k.translatedMessage,timestamp:new Date().toISOString()};i("solution",E)}catch(S){console.error("LLM处理错误:",S);const k={type:"processing",title:"处理出错",steps:[{name:"错误信息",content:"抱歉，处理过程中出现了错误，请稍后重试。"}],timestamp:new Date().toISOString()};i("llm",k)}finally{s(!1)}},[i,r,t.problem,t.solution]),h=x.useCallback(async b=>{const y={type:"user",text:b.text,timestamp:b.timestamp};i("solution",y),s(!0);try{const S=[...t.problem.filter(l=>l.type==="user"||l.type==="ai_response").map(l=>({...l,panel:"problem"})),...t.solution.filter(l=>l.type==="user"||l.type==="ai_response"||l.type==="llm_request").map(l=>({...l,panel:"solution"})),...t.llm.filter(l=>l.type==="processing"&&l.output).map(l=>({type:"llm_processing",text:l.output,timestamp:l.timestamp,panel:"llm"})),{...y,panel:"solution"}].sort((l,C)=>new Date(l.timestamp)-new Date(C.timestamp)),k=await P({type:"solution_response",content:b.text,context:"solution_to_problem",scenario:r,chatHistory:S}),R={type:"processing",title:"处理方案端响应",steps:k.steps,output:k.optimizedMessage,timestamp:new Date().toISOString()};i("llm",R);const E={type:"ai_response",text:k.optimizedMessage,timestamp:new Date().toISOString()};i("problem",E)}catch(S){console.error("LLM处理错误:",S);const k={type:"processing",title:"处理出错",steps:[{name:"错误信息",content:"抱歉，处理过程中出现了错误，请稍后重试。"}],timestamp:new Date().toISOString()};i("llm",k)}finally{s(!1)}},[i,r,t.problem,t.solution]),g=x.useCallback(async()=>{if(!c){n(!0);try{const y=[...t.problem.filter(l=>l.type==="user"||l.type==="ai_response").slice(-2),...t.solution.filter(l=>l.type==="user"||l.type==="ai_response").slice(-2)].sort((l,C)=>new Date(l.timestamp)-new Date(C.timestamp)).map(l=>l.text).join(`
`),S=[...t.problem.filter(l=>l.type==="user"||l.type==="ai_response").map(l=>({...l,panel:"problem"})),...t.solution.filter(l=>l.type==="user"||l.type==="ai_response"||l.type==="llm_request").map(l=>({...l,panel:"solution"})),...t.llm.filter(l=>l.type==="processing"&&l.output).map(l=>({type:"llm_processing",text:l.output,timestamp:l.timestamp,panel:"llm"}))].sort((l,C)=>new Date(l.timestamp)-new Date(C.timestamp)),k=await P({type:"generate_suggestion",content:y,scenario:r,chatHistory:S}),R={type:"processing",title:"生成企业端建议",steps:k.steps,output:k.suggestionMessage,timestamp:new Date().toISOString()};i("llm",R);const E={type:"suggestion",text:k.suggestionMessage,timestamp:new Date().toISOString()};i("solution",E),m(!0),d(k.suggestionMessage)}catch(b){console.error("生成建议错误:",b);const y={type:"processing",title:"生成建议出错",steps:[{name:"错误信息",content:"抱歉，生成建议时出现了错误，请稍后重试。"}],timestamp:new Date().toISOString()};i("llm",y)}finally{n(!1)}}},[i,r,t.problem,t.solution,c]),N=x.useCallback(async()=>{if(!c){n(!0);try{const y=[...t.problem.filter(l=>l.type==="user"||l.type==="ai_response").slice(-2),...t.solution.filter(l=>l.type==="user"||l.type==="ai_response").slice(-2)].sort((l,C)=>new Date(l.timestamp)-new Date(C.timestamp)).map(l=>l.text).join(`
`),S=[...t.problem.filter(l=>l.type==="user"||l.type==="ai_response").map(l=>({...l,panel:"problem"})),...t.solution.filter(l=>l.type==="user"||l.type==="ai_response"||l.type==="llm_request").map(l=>({...l,panel:"solution"})),...t.llm.filter(l=>l.type==="processing"&&l.output).map(l=>({type:"llm_processing",text:l.output,timestamp:l.timestamp,panel:"llm"}))].sort((l,C)=>new Date(l.timestamp)-new Date(C.timestamp)),k=await P({type:"generate_followup",content:y,scenario:r,chatHistory:S}),R={type:"processing",title:"生成企业端追问",steps:k.steps,output:k.followUpMessage,timestamp:new Date().toISOString()};i("llm",R);const E={type:"followup",text:k.followUpMessage,timestamp:new Date().toISOString()};i("solution",E),m(!0),d(k.followUpMessage)}catch(b){console.error("生成追问错误:",b);const y={type:"processing",title:"生成追问出错",steps:[{name:"错误信息",content:"抱歉，生成追问时出现了错误，请稍后重试。"}],timestamp:new Date().toISOString()};i("llm",y)}finally{n(!1)}}},[i,r,t.problem,t.solution,c]),w=x.useCallback(async b=>{if(!o){s(!0);try{const y=[...t.problem.filter(E=>E.type==="user"||E.type==="ai_response").map(E=>({...E,panel:"problem"})),...t.solution.filter(E=>E.type==="user"||E.type==="ai_response").map(E=>({...E,panel:"solution"}))].sort((E,l)=>new Date(E.timestamp)-new Date(l.timestamp)),S=await P({type:"solution_response",content:b,context:"solution_to_problem",scenario:r,chatHistory:y}),k={type:"processing",title:"处理最终响应",steps:S.steps,output:S.optimizedMessage,timestamp:new Date().toISOString()};i("llm",k);const R={type:"ai_response",text:S.optimizedMessage,timestamp:new Date().toISOString()};i("problem",R),m(!1),d(null)}catch(y){console.error("确认发送错误:",y);const S={type:"processing",title:"处理最终响应出错",steps:[{name:"错误信息",content:"抱歉，处理最终响应时出现了错误，请稍后重试。"}],timestamp:new Date().toISOString()};i("llm",S)}finally{s(!1)}}},[i,r,t.problem,t.solution,o]),I=x.useCallback(()=>{m(!1),d(null)},[]);return{messages:t,llmProcessing:o,iterationProcessing:c,iterationMode:u,pendingResponse:j,sendProblemMessage:f,sendSolutionMessage:h,generateSuggestion:g,generateFollowUp:N,confirmSendResponse:w,cancelIteration:I,clearMessages:p}},J={retail:{id:"retail",name:"零售场景",icon:"fas fa-shopping-bag",description:"顾客与企业门店的沟通",problemRole:"顾客/消费者",solutionRole:"企业门店/销售代表",example:"我下周要去参加AOM国际会议做主旨演讲，需要一套正式但现代的商务西装，预算在800-1500元之间，身高175cm，希望能显得专业又有活力。"},enterprise:{id:"enterprise",name:"企业场景",icon:"fas fa-users",description:"企业跨部门沟通",problemRole:"市场部经理",solutionRole:"研发部技术人员",example:"我们的移动APP用户留存率只有30%，需要在3个月内开发个性化推荐功能来提升至45%，目标用户是18-35岁，预算50万元。"},education:{id:"education",name:"教育场景",icon:"fas fa-graduation-cap",description:"学生与教师的互动",problemRole:"学生",solutionRole:"教师",example:"我在学习量子物理时，对波粒二象性概念理解困难，特别是为什么光既是波又是粒子，希望通过具体实验例子来理解这个概念。"}};function He(){const[r,t]=x.useState("retail"),[a,o]=x.useState(!1),{messages:s,llmProcessing:c,iterationProcessing:n,iterationMode:u,pendingResponse:m,sendProblemMessage:j,sendSolutionMessage:d,generateSuggestion:i,generateFollowUp:p,confirmSendResponse:f,cancelIteration:h,clearMessages:g}=Ze(r),N=I=>{t(I),g()},w=J[r];return T.ENABLE_DEBUG&&(console.log("Current scenario:",w),console.log("Messages:",s)),e.jsx(xe,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:T.APP_TITLE}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["v",T.APP_VERSION]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Ce,{scenarios:J,currentScenario:r,onScenarioChange:N}),e.jsx("button",{onClick:()=>o(!0),className:"btn-ghost",title:"设置",children:e.jsx("i",{className:"fas fa-cog"})}),e.jsx("button",{onClick:g,className:"btn-ghost",title:"清空所有消息",children:e.jsx("i",{className:"fas fa-trash"})})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-8rem)]",children:[e.jsx("div",{className:"panel",children:e.jsx(Ae,{scenario:w,messages:s.problem,onSendMessage:j,isProcessing:c})}),e.jsx("div",{className:"panel",children:e.jsx(Te,{processing:c,messages:s.llm})}),e.jsx("div",{className:"panel",children:e.jsx(De,{scenario:w,messages:s.solution,onSendMessage:d,isProcessing:c,iterationProcessing:n,iterationMode:u,pendingResponse:m,onGenerateSuggestion:i,onGenerateFollowUp:p,onConfirmSend:f,onCancelIteration:h})})]})}),a&&e.jsx(Ue,{onClose:()=>o(!1)}),e.jsx(ze,{onClearMessages:g,onToggleSettings:()=>o(!a)}),e.jsx(Pe,{})]})})}q.createRoot(document.getElementById("root")).render(e.jsx(ae.StrictMode,{children:e.jsx(He,{})}));
